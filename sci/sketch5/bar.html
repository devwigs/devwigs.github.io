<!DOCTYPE html>
<html lang="en-ca">
<head>
<meta charset="utf8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Bar Chart</title>
<link rel="shortcut icon" type="image/png" href="../media/rocket.png" />
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Oxygen:400,700" />
<style type="text/css">

canvas {
    max-width:96vw;
    touch-action:none;
}

</style>
<script type="text/javascript" src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script type="text/javascript" src="../script/math.js"></script>
<!-- <script type="text/javascript" src="../script/sketch5.js"></script> -->
<script type="text/javascript" src="../sketch5/core.js"></script>
<script type="text/javascript" src="../sketch5/sprite.js"></script>
<script type="text/javascript" src="../sketch5/shape.js"></script>
<script type="text/javascript" src="../sketch5/misc.js"></script>
<script type="text/javascript">

/* Call setup function after preloading images */

$(function() {
    Sketch.init(setup, {
        Ek: "../media/latex/blue/Ek.png",
        Eg: "../media/latex/blue/Eg.png",
        Er: "../media/latex/blue/Erotn.png",
        W: "../media/latex/red/Wloss.png"
    });
})


function setup(imgs) {
    data = [3, 6, 2, 5];
    let sk = barGraph("#Test", data, {margin: [36, 2, 38, 2]}, {fill:"#aaf"});
    sk.config({fill:"#faa"}, "Bar_3");

    labels = [imgs.Ek, imgs.Eg, imgs.Er, imgs.W];
    labels = sk.series("Lbl_", labels, [0, 1, 2, 3], 0, [0, -0.2], {valign:"top"});
    for (let i in labels) labels[i].scale(0.75);

    sk.css({border:"1px solid blue", padding:"2px"}).draw();
}

function barGraph(cv, data, opt, ...attr) {
    /**** opt...
     * y, dy: vertical scale
     * barWidth
     * margin
     * key: key (suffixed by index)
     *
    ***/

    // Create a sketch with coordinate system
    let sk = new Sketch(cv);

    //
    opt = join({y:10, dy:1, barWidth:0.75, margin:2, key:"Bar_"}, opt);
    let w = opt.barWidth;
    let n = data.length, l = w/2 - 1, r = n - w/2;
    sk.createCS([160, -40], l, r, 0, opt.y, opt.margin);

    // Draw the coordinate grid
    let grey = {stroke:"grey", lineWidth:0.5};
    sk.gridLines([l, r, r-l], [0, opt.y, opt.dy], grey);

    for (let i=0;i<data.length;i++) {
        let h = data[i];
        sk.rect(opt.key + i, i, 0, w, h, BOTTOM, ...attr);
    }

    // Configure x-axis
    Object.assign(sk.item("GridH_0").setIndex(-1), {stroke:"black", lineWidth:2});
    return sk;
}

function modifyBarData(sk, key, data) {
    for (let i=0;i<data.length;i++) {
        let v = sk.item(key + i).vertices;
        v[2][1] = v[3][1] = data[i];
    }
}

</script>
</head>
<body>
    <p><canvas id="Test" width="600" height="400"></canvas></p>
</body>
</html>